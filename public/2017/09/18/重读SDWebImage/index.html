

<!DOCTYPE html>
<html lang="">
<head prefix="og: http://ogp.me/ns#">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <meta name="description" content="">
    <title>重读SDWebImage | 武小鹏的博客</title>

    <!-- Open Graph -->
    <meta name="description" content="&amp;#x91CD;&amp;#x8BFB;SDWebImage&amp;#x5F88;&amp;#x65E9;&amp;#x4EE5;&amp;#x524D;&amp;#x521A;&amp;#x63A5;&amp;#x89E6;iOS&amp;#x5F00;&amp;#x53D1;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x5C31;&amp;#x77E5;&amp;#x9053;SDWebImage&amp;#x7684;&amp;#x5F3A;&amp;#x5927;&amp;#x548C;&amp;#x6D41;&amp;">
<meta name="keywords" content="iOS,苹果,移动端,OC,Swift,Objective-C,Mobile,开发者,程序猿,程序媛,极客,编程,代码,开源,IT网站,Developer,Programmer,Coder,Geek,html,css,css3,用户体验">
<meta property="og:type" content="article">
<meta property="og:title" content="重读SDWebImage">
<meta property="og:url" content="http://yoursite.com/2017/09/18/重读SDWebImage/index.html">
<meta property="og:site_name" content="武小鹏的博客">
<meta property="og:description" content="&amp;#x91CD;&amp;#x8BFB;SDWebImage&amp;#x5F88;&amp;#x65E9;&amp;#x4EE5;&amp;#x524D;&amp;#x521A;&amp;#x63A5;&amp;#x89E6;iOS&amp;#x5F00;&amp;#x53D1;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x5C31;&amp;#x77E5;&amp;#x9053;SDWebImage&amp;#x7684;&amp;#x5F3A;&amp;#x5927;&amp;#x548C;&amp;#x6D41;&amp;">
<meta property="og:image" content="http://yoursite.com/2017/09/18/重读SDWebImage/SDWebImageSequenceDiagram.png">
<meta property="og:image" content="http://yoursite.com/2017/09/18/重读SDWebImage/SDWebImageClassDiagram.png">
<meta property="og:updated_time" content="2017-09-27T01:54:58.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="重读SDWebImage">
<meta name="twitter:description" content="&amp;#x91CD;&amp;#x8BFB;SDWebImage&amp;#x5F88;&amp;#x65E9;&amp;#x4EE5;&amp;#x524D;&amp;#x521A;&amp;#x63A5;&amp;#x89E6;iOS&amp;#x5F00;&amp;#x53D1;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x5C31;&amp;#x77E5;&amp;#x9053;SDWebImage&amp;#x7684;&amp;#x5F3A;&amp;#x5927;&amp;#x548C;&amp;#x6D41;&amp;">
<meta name="twitter:image" content="http://yoursite.com/2017/09/18/重读SDWebImage/SDWebImageSequenceDiagram.png">

    <script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Person",
  "email": "mailto:allenwooop@gmail.com",
  "image": "",
  "name": "Wooop",
  "url": "http://yoursite.com"
}
</script>
    <script>
    var algoliaEnabled = false;
    
</script>

    

    
    
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
    
    
    
        <!-- stylesheets list from config.yml -->
        
        <link rel="stylesheet" href="/css/aloha.css">
        
        <link rel="stylesheet" href="//cdn.bootcss.com/semantic-ui/2.2.4/semantic.min.css">
        
        <link rel="stylesheet" href="//cdn.bootcss.com/magnific-popup.js/1.1.0/magnific-popup.min.css">
        
    

</head>
<body id="body" style="margin-bottom: 0;" class="pushable">

    <div class="ui top fixed menu">
        <a class="item" id="menu-icon"><i class="sidebar icon"></i></a>
    </div>

    <div id="menu-sidebar" class="ui left vertical sidebar menu">

    <div id="sidebar-top">
        <div class="content">
            <h3>武小鹏的博客</h3>
        </div>
    </div>
    <div class="ui container sidebar-card">
    <div class="ui people shape content">
        <div class="active side">
            <div class="ui card">
                <div class="image">
                    <img class="ui medium bordered image" src="/images/avatar.jpg">
                </div>
                <div class="content">
                    <a class="header">Wooop</a>
                    
                        <div class="meta">
                            Programer
                        </div>
                    
                </div>
                <div class="extra content">
                    <div class="ui list">
                        
                        <div class="item">
                            <i class="marker icon" style="float: left"></i>
                            <div class="content">Hangzhou</div>
                        </div>
                        
                        
                        <div class="item">
                            <i class="mail icon" style="float: left"></i>
                            <div class="content">
                                <a href="mailto:allenwooop@gmail.com">allenwooop@gmail.com</a>
                            </div>
                        </div>
                        
                    </div>

                </div>
                <div class="extra content">
                    <div class="ui list">
                        

                                <a href="https://github.com/Woooop"><i class="large github icon" style="float: left"></i></a>

                            
                    </div>
                </div>
            </div>
        </div>
    </div>


</div>

    
    

    

    
    <a href="/index.html" class="item" >
        <i class="home icon"></i>
        HOME
    </a>

    

    
</div>

    <div class="pusher body-content">
        <div id="content" class="ui main container">
            <!--<div class="ui one column grid">-->
                <!--<div class="column">-->
                    <!--<div class="ui main container">-->
                        <div id="post-重读SDWebImage" class="ui main container article-type-post">

    

    <div class="ui divided grid">

        <div class="two column row" id="article-content">

            <div class="thirteen wide computer thirteen wide tablet sixteen wide mobile column">
                

<h1 class="ui header">
    
    重读SDWebImage
</h1>



                <div class="article-inner">

                    <div class="article-entry" itemprop="articleBody">
                        
                        <h4 id="&#x91CD;&#x8BFB;SDWebImage"><a href="#&#x91CD;&#x8BFB;SDWebImage" class="headerlink" title="&#x91CD;&#x8BFB;SDWebImage"></a>&#x91CD;&#x8BFB;SDWebImage</h4><p>&#x5F88;&#x65E9;&#x4EE5;&#x524D;&#x521A;&#x63A5;&#x89E6;iOS&#x5F00;&#x53D1;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x77E5;&#x9053;SDWebImage&#x7684;&#x5F3A;&#x5927;&#x548C;&#x6D41;&#x884C;&#xFF0C;&#x5728;&#x5927;&#x90E8;&#x5206;&#x7684;iOS&#x9879;&#x76EE;&#x4E2D;&#x90FD;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5979;&#x7684;&#x8EAB;&#x5F71;&#xFF0C;&#x4E5F;&#x662F;&#x76F8;&#x5F53;&#x7ECF;&#x5178;&#x7684;&#x7B2C;&#x4E09;&#x65B9;&#x5E93;&#xFF0C;&#x975E;&#x5E38;&#x503C;&#x5F97;&#x9605;&#x8BFB;&#xFF0C;&#x53EA;&#x662F;&#x4E00;&#x76F4;&#x4EE5;&#x6765;&#x90FD;&#x53EA;&#x662F;&#x5927;&#x81F4;&#x4E86;&#x89E3;&#x5176;&#x8FD0;&#x884C;&#x7684;&#x6D41;&#x7A0B;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x6DF1;&#x5165;&#x9605;&#x8BFB;&#x6E90;&#x7801;&#xFF0C;&#x5176;&#x4E2D;&#x7684;&#x8BB8;&#x591A;&#x8BBE;&#x8BA1;&#x548C;&#x7EC6;&#x8282;&#x90FD;&#x975E;&#x5E38;&#x503C;&#x5F97;&#x5B66;&#x4E60;&#xFF0C;&#x6240;&#x4EE5;&#x8BA9;&#x6211;&#x4EEC;&#x518D;&#x6B21;&#x53BB;&#x4E00;&#x63A2;&#x7A76;&#x7ADF;&#x3002;</p>
<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x4ECE;&#x4E00;&#x5F20;&#x65F6;&#x5E8F;&#x56FE;&#x6765;&#x4E86;&#x89E3;SDWebImage&#x6700;&#x4E3B;&#x8981;&#x7684;&#x5DE5;&#x4F5C;&#x6D41;&#x7A0B;&#x3002;<a class="magnific-img" href="SDWebImageSequenceDiagram.png"><img src="SDWebImageSequenceDiagram.png" alt="" class="ui centered image"></a></p>
<p>&#x5176;&#x5DE5;&#x4F5C;&#x6D41;&#x7A0B;&#x53EF;&#x4EE5;&#x5206;&#x4E3A;&#x4E0B;&#x5217;&#x7684;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ol class="ui list">
<li>&#x63A7;&#x4EF6;&#x8C03;&#x7528;setImageWithURL&#x63A5;&#x53E3;</li>
<li>&#x8FFD;&#x6EAF;&#x5230;UIView&#x7684;loadImageWithURL&#x65B9;&#x6CD5;</li>
<li>&#x5728;SDWebImageManager&#x4E2D;&#x9996;&#x5148;&#x901A;&#x8FC7;queryDiskCacheForKey&#x65B9;&#x6CD5;&#x5BFB;&#x627E;&#x6240;&#x8BF7;&#x6C42;&#x7684;&#x56FE;&#x7247;&#x662F;&#x5426;&#x5728;&#x6C99;&#x76D2;&#x4E2D;&#x7F13;&#x5B58;</li>
<li>&#x5982;&#x679C;&#x6709;&#xFF0C;&#x5219;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;Image&#xFF0C;&#x5426;&#x5219;&#x901A;&#x8FC7;downloadImage&#x65B9;&#x6CD5;&#x4F7F;&#x7528;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x7C7B;SDWebImageDownloader&#x4E0B;&#x8F7D;&#x56FE;&#x7247;&#xFF0C;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x540E;&#xFF0C;&#x901A;&#x8FC7;storeImage&#x7F13;&#x5B58;&#x56FE;&#x7247;&#xFF0C;&#x800C;&#x540E;&#x518D;&#x8FD4;&#x56DE;Image</li>
<li>&#x628A;Image&#x6570;&#x636E;set&#x5230;&#x76F8;&#x5E94;&#x7684;&#x63A7;&#x4EF6;&#x4E0A;</li>
</ol>
<p>&#x4E86;&#x89E3;&#x4E86;&#x57FA;&#x672C;&#x6D41;&#x7A0B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x770B;&#x770B;&#x5177;&#x4F53;&#x7684;&#x7C7B;&#x7ED3;&#x6784;&#x3002;<a class="magnific-img" href="SDWebImageClassDiagram.png"><img src="SDWebImageClassDiagram.png" alt="" class="ui centered image"></a></p>
<p>&#x521D;&#x770B;&#x8D77;&#x6765;&#x662F;&#x6BD4;&#x8F83;&#x590D;&#x6742;&#x7684;&#x4E00;&#x5F20;&#x7C7B;&#x56FE;&#xFF0C;&#x4F46;&#x4ED4;&#x7EC6;&#x770B;&#x770B;&#x540E;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x5176;&#x5B9E;&#x4ED6;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#x662F;&#x6BD4;&#x8F83;&#x6E05;&#x6670;&#x7684;&#x3002;</p>
<ul class="ui list">
<li>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x4ECE;&#x5DE6;&#x4E0A;&#x89D2;&#x5F00;&#x59CB;&#x770B;&#x8D77;&#xFF0C;&#x5BF9;UIButton&#x3001;UIImageView&#x7B49;&#x63A7;&#x4EF6;&#x6DFB;&#x52A0;&#x5206;&#x7C7B;&#x65B9;&#x6CD5;&#x4F5C;&#x4E3A;&#x4E0B;&#x8F7D;&#x56FE;&#x7247;&#x7684;&#x5165;&#x53E3;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x65B9;&#x6CD5;&#x6700;&#x7EC8;&#x8D70;&#x4ED6;&#x4EEC;&#x7236;&#x7C7B;UIview&#x7684;&#x65B9;&#x6CD5;sd_internalSetImage</li>
<li>SDWebImageManager &#x4F5C;&#x4E3A;&#x8FDE;&#x63A5;&#x6240;&#x6709;&#x7C7B;&#x7684;&#x6838;&#x5FC3;&#xFF0C;&#x5728;sd_internalSetImage&#x65B9;&#x6CD5;&#x4E2D;&#x901A;&#x8FC7;&#x8C03;&#x7528;loadImageWithURL&#x8FDB;&#x5165;&#x3002;</li>
<li>SDWebImageCombinedOperation &#x63CF;&#x8FF0;&#x7684;&#x662F;&#x4E00;&#x4E2A;&#x5728;Manager&#x5C42;&#x9762;&#x7684;&#x4E0B;&#x8F7D;&#x64CD;&#x4F5C;&#xFF0C;&#x91CC;&#x9762;&#x5305;&#x542B;&#x4E86;&#x53D6;&#x6D88;block&#x8FD8;&#x6709;&#x771F;&#x6B63;&#x7684;&#x4E0B;&#x8F7D;&#x64CD;&#x4F5C;Operation&#x3002;</li>
<li>SDWebImageManagerDelegate &#x63D0;&#x4F9B;&#x4E00;&#x4E9B;&#x4EE3;&#x7406;&#x65B9;&#x6CD5;&#x7ED9;&#x5916;&#x90E8;&#x4F7F;&#x7528;</li>
<li>SDImageCache &#x770B;&#x5176;&#x540D;&#x5B57;&#x5C31;&#x77E5;&#x9053;&#x662F;&#x63D0;&#x4F9B;&#x7F13;&#x5B58;&#x529F;&#x80FD;&#x7684;</li>
<li>SDImageCacheConfig &#x914D;&#x7F6E;&#x7F13;&#x5B58;&#x8BBE;&#x7F6E;&#x4FE1;&#x606F;&#x7684;&#x5C5E;&#x6027;&#x53CA;&#x65B9;&#x6CD5;</li>
<li>SDWebImageDownloader &#x770B;&#x5176;&#x540D;&#x5B57;&#x4E5F;&#x77E5;&#x9053;&#x662F;&#x7528;&#x6765;&#x4E0B;&#x8F7D;&#x56FE;&#x7247;&#x7684;</li>
<li>SDWebImageDownloaderOperation &#x4E00;&#x4E2A;&#x771F;&#x6B63;&#x7684;&#x4E0B;&#x8F7D;&#x4EFB;&#x52A1;</li>
<li>SDWebImageDownloadToken &#x7528;&#x6765;&#x63CF;&#x8FF0;&#x4E00;&#x4E2A;&#x4E0B;&#x8F7D;&#x4EFB;&#x52A1;&#x7684;&#x7279;&#x5F81;</li>
<li>SDWebImageDownloaderOperationInterface &#x5982;&#x679C;&#x60F3;&#x8981;&#x81EA;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x4E0B;&#x8F7D;&#x4EFB;&#x52A1;&#x7684;&#x8BDD;&#xFF0C;&#x5FC5;&#x987B;&#x9075;&#x5B88;&#x7684;&#x534F;&#x8BAE;</li>
<li>SDWebImagePrefetcher &#x7528;&#x6765;&#x9884;&#x4E0B;&#x8F7D;&#x56FE;&#x7247;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x4E0B;&#x8F7D;&#x5B8C;&#x5148;&#x4E0D;&#x4F7F;&#x7528;</li>
</ul>
<p>&#x8FD9;&#x4E48;&#x591A;&#x7C7B;&#x4E2D;&#xFF0C;&#x5176;&#x5B9E;&#x652F;&#x6491;SDWebImage&#x8FD0;&#x4F5C;&#x7684;&#x6700;&#x4E3B;&#x8981;&#x7684;&#x4E09;&#x4E2A;&#x90E8;&#x5206;&#xFF0C;&#x4ED6;&#x4EEC;&#x5206;&#x522B;&#x662F;&#xFF1A;SDWebImageManager&#x3001;SDImageCache&#x3001;SDWebImageDownloader&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x9010;&#x4E00;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x7EC6;&#x7EC6;&#x5206;&#x6790;&#xFF0C;&#x770B;&#x770B;&#x4ED6;&#x4EEC;&#x5230;&#x5E95;&#x662F;&#x600E;&#x4E48;&#x5DE5;&#x4F5C;&#x7684;&#x3002;</p>
<h5 id="SDWebImageManager"><a href="#SDWebImageManager" class="headerlink" title="SDWebImageManager"></a>SDWebImageManager</h5><p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x67E5;&#x770B;SDWebImageManager.m&#x7684;&#x6E90;&#x7801;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x5176;&#x4E2D;&#x8FD1;&#x4E00;&#x534A;&#x591A;&#x7684;&#x7BC7;&#x5E45;&#x90FD;&#x88AB;&#x5355;&#x72EC;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x5360;&#x636E;&#x4E86;&#xFF0C;&#x4ED6;&#x5C31;&#x662F;&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x63D0;&#x8FC7;&#x7684;&#xFF1A;</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">id</span> &lt;SDWebImageOperation&gt;)loadImageWithURL:(<span class="keyword">nullable</span> <span class="built_in">NSURL</span> *)url options:(SDWebImageOptions)options progress:(<span class="keyword">nullable</span> SDWebImageDownloaderProgressBlock)progressBlock completed:(<span class="keyword">nullable</span> SDInternalCompletionBlock)completedBlock;</div></pre></td></tr></table></figure>
<p>&#x5F88;&#x660E;&#x663E;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x662F;SDWebImageManager&#x4E2D;&#x6700;&#x6838;&#x5FC3;&#x7684;&#x5DE5;&#x4F5C;&#x6D41;&#x7A0B;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x9010;&#x4E00;&#x68B3;&#x7406;&#x5176;&#x4E2D;&#x7684;&#x903B;&#x8F91;&#x3002;</p>
<ol class="ui list">
<li><p>&#x68C0;&#x67E5;URL&#x7684;&#x5408;&#x6CD5;&#x6027;</p>
</li>
<li><p>&#x68C0;&#x67E5;URL&#x662F;&#x5426;&#x66FE;&#x7ECF;&#x5931;&#x8D25;&#x8FC7;</p>
</li>
<li><p>&#x7ED3;&#x5408;&#x4E0A;&#x9762;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x9009;&#x62E9;&#x662F;&#x5426;&#x63D0;&#x524D;&#x56DE;&#x8C03;&#x3002;</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[<span class="keyword">self</span> callCompletionBlockForOperation:operation completion:completedBlock error:[<span class="built_in">NSError</span> errorWithDomain:<span class="built_in">NSURLErrorDomain</span> code:<span class="built_in">NSURLErrorFileDoesNotExist</span> userInfo:<span class="literal">nil</span>] url:url];</div></pre></td></tr></table></figure>
</li>
<li><p>&#x6839;&#x636E;URL&#x83B7;&#x53D6;CacheKey&#xFF0C;&#x901A;&#x8FC7;CacheKey&#x53BB;&#x672C;&#x5730;&#x5BFB;&#x627E;&#x56FE;&#x7247;&#xFF0C;&#x73B0;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x627E;&#xFF0C;&#x5982;&#x679C;&#x5185;&#x5B58;&#x4E2D;&#x6CA1;&#x6709;&#x5C31;&#x53BB;&#x6C99;&#x76D2;&#x4E2D;&#x627E;&#xFF0C;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x4E86;GCD&#x5F02;&#x6B65;&#x51FD;&#x6570;&#xFF0C;&#x4E13;&#x95E8;&#x5728;&#x4E00;&#x4E2A;IO&#x7EBF;&#x7A0B;&#x91CC;&#x505A;&#x6C99;&#x76D2;&#x5B58;&#x53D6;&#x7684;&#x64CD;&#x4F5C;&#x3002;</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">nullable</span> <span class="built_in">NSOperation</span> *)queryCacheOperationForKey:(<span class="keyword">nullable</span> <span class="built_in">NSString</span> *)key done:(<span class="keyword">nullable</span> SDCacheQueryCompletedBlock)doneBlock {</div><div class="line">    <span class="comment">// First check the in-memory cache...</span></div><div class="line">    <span class="built_in">UIImage</span> *image = [<span class="keyword">self</span> imageFromMemoryCacheForKey:key];</div><div class="line">    <span class="keyword">if</span> (image) {</div><div class="line">        <span class="built_in">NSData</span> *diskData = <span class="literal">nil</span>;</div><div class="line">        <span class="keyword">if</span> ([image isGIF]) {</div><div class="line">            diskData = [<span class="keyword">self</span> diskImageDataBySearchingAllPathsForKey:key];</div><div class="line">        }</div><div class="line">        <span class="keyword">if</span> (doneBlock) {</div><div class="line">            doneBlock(image, diskData, SDImageCacheTypeMemory);</div><div class="line">        }</div><div class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="built_in">NSOperation</span> *operation = [<span class="built_in">NSOperation</span> new];</div><div class="line">    <span class="built_in">dispatch_async</span>(<span class="keyword">self</span>.ioQueue, ^{</div><div class="line">        <span class="keyword">if</span> (operation.isCancelled) {</div><div class="line">            <span class="comment">// do not call the completion if cancelled</span></div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        }</div><div class="line">        <span class="keyword">@autoreleasepool</span> {</div><div class="line">            <span class="built_in">NSData</span> *diskData = [<span class="keyword">self</span> diskImageDataBySearchingAllPathsForKey:key];</div><div class="line">            <span class="built_in">UIImage</span> *diskImage = [<span class="keyword">self</span> diskImageForKey:key];</div><div class="line">            <span class="keyword">if</span> (diskImage &amp;&amp; <span class="keyword">self</span>.config.shouldCacheImagesInMemory) {</div><div class="line">                <span class="built_in">NSUInteger</span> cost = SDCacheCostForImage(diskImage);</div><div class="line">                [<span class="keyword">self</span>.memCache setObject:diskImage forKey:key cost:cost];</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (doneBlock) {</div><div class="line">                <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^{</div><div class="line">                    doneBlock(diskImage, diskData, SDImageCacheTypeDisk);</div><div class="line">                });</div><div class="line">            }</div><div class="line">        }</div><div class="line">    });</div></pre></td></tr></table></figure>
</li>
<li><p>&#x5982;&#x679C;&#x7F13;&#x5B58;&#x4E2D;&#x6709;&#xFF0C;&#x5219;&#x56DE;&#x8C03;&#xFF0C;&#x6CA1;&#x6709;&#x7684;&#x8BDD;&#x5219;&#x53BB;&#x7F51;&#x7EDC;&#x4E0B;&#x8F7D;</p>
<p> &#x8FD9;&#x91CC;&#x6709;&#x4E2A;&#x503C;&#x5F97;&#x4E00;&#x8BF4;&#x7684;&#x70B9;&#x5C31;&#x662F;&#x4F5C;&#x8005;&#x901A;&#x8FC7;&#x4F4D;&#x79FB;&#x8FD0;&#x7B97;&#x7B26;&#x505A;SDWebImageDownloaderOptions&#x7684;&#x679A;&#x4E3E;&#x503C;&#xFF0C;&#x901A;&#x8FC7;&#x5BF9;&#x679A;&#x4E3E;&#x503C;&#x8FDB;&#x884C;&#x6216;&#x8FD0;&#x7B97;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x503C;&#x63CF;&#x8FF0;&#x591A;&#x4E2A;&#x679A;&#x4E3E;&#x3002;</p>
  <figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">SDWebImageDownloaderLowPriority = <span class="number">1</span> &lt;&lt; <span class="number">0</span> <span class="comment">//00000001</span></div><div class="line">SDWebImageDownloaderProgressiveDownload = <span class="number">1</span> &lt;&lt; <span class="number">1</span> <span class="comment">//00000010</span></div><div class="line">SDWebImageDownloaderUseNSURLCache = <span class="number">1</span> &lt;&lt; <span class="number">2</span> <span class="comment">//00000100</span></div><div class="line">options =  SDWebImageDownloaderLowPriority || SDWebImageDownloaderProgressiveDownload || SDWebImageDownloaderUseNSURLCache</div><div class="line">options = <span class="number">00000111</span></div></pre></td></tr></table></figure>
<p> &#x8BBE;&#x7F6E;&#x597D;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#x540E;&#x53BB;&#x7F51;&#x7EDC;&#x4E0B;&#x8F7D;</p>
</li>
<li><p>&#x5982;&#x679C;&#x4E0B;&#x8F7D;&#x6210;&#x529F;&#x540E;&#x5C31;&#x628A;&#x56FE;&#x7247;cache&#x8D77;&#x6765;&#xFF0C;&#x7136;&#x540E;&#x56DE;&#x8C03;</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">if</span> (downloadedImage &amp;&amp; finished) {</div><div class="line">	[<span class="keyword">self</span>.imageCache storeImage:downloadedImage imageData:downloadedData forKey:key toDisk:cacheOnDisk completion:<span class="literal">nil</span>];}</div><div class="line">[<span class="keyword">self</span> callCompletionBlockForOperation:strongOperation completion:completedBlock image:downloadedImage data:downloadedData error:<span class="literal">nil</span> cacheType:SDImageCacheTypeNone finished:finished url:url];</div></pre></td></tr></table></figure>
</li>
</ol>
<p>&#x4EE5;&#x4E0A;&#x5C31;&#x662F;SDWebImageManager&#x7684;&#x4E3B;&#x8981;&#x529F;&#x80FD;&#x548C;&#x6D41;&#x7A0B;&#xFF0C;&#x5728;&#x8FD9;&#x5176;&#x4E2D;&#x5305;&#x542B;&#x4E86;&#x5BF9;imageCache&#x548C;imageDownloader&#x7684;&#x8C03;&#x7528;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x5C31;&#x5148;&#x8BF4;&#x4E00;&#x8BF4;imageCache&#x3002;</p>
<h5 id="SDImageCache"><a href="#SDImageCache" class="headerlink" title="SDImageCache"></a>SDImageCache</h5><p>&#x5176;&#x5B9E;SDImageCache&#x7684;&#x529F;&#x80FD;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x662F;&#x5BF9;&#x56FE;&#x7247;&#x7684;&#x7F13;&#x5B58;&#xFF0C;&#x7F13;&#x5B58;&#x6709;&#x4E24;&#x4E2A;&#x5730;&#x65B9;&#xFF0C;&#x4E00;&#x4E2A;&#x662F;&#x5185;&#x5B58;memory&#xFF0C;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x662F;&#x6C99;&#x76D2;disk&#x3002;SDImageCache&#x5206;&#x522B;&#x63D0;&#x4F9B;&#x4E86;&#x5BF9;&#x8FD9;&#x4E24;&#x4E2A;&#x5730;&#x65B9;&#x8FDB;&#x884C;&#x56FE;&#x7247;&#x7684;&#x5B58;&#x3001;&#x53D6;&#x3001;&#x5220;&#x7684;&#x529F;&#x80FD;&#x3002;&#x6211;&#x4EEC;&#x5C31;&#x901A;&#x8FC7;&#x9010;&#x4E00;&#x4ECB;&#x7ECD;&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x4F5C;&#x4E3A;&#x5207;&#x5165;&#x70B9;&#x5BF9;SDImageCache&#x8FDB;&#x884C;&#x5206;&#x6790;&#x3002;</p>
<ul class="ui list">
<li><p>&#x5B58;&#x50A8;Store</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)storeImage:(<span class="keyword">nullable</span> <span class="built_in">UIImage</span> *)image</div><div class="line">         imageData:(<span class="keyword">nullable</span> <span class="built_in">NSData</span> *)imageData</div><div class="line">            forKey:(<span class="keyword">nullable</span> <span class="built_in">NSString</span> *)key</div><div class="line">            toDisk:(<span class="built_in">BOOL</span>)toDisk</div><div class="line">        completion:(<span class="keyword">nullable</span> SDWebImageNoParamsBlock)completionBlock;</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x4E9B;&#x53C2;&#x6570;&#x90FD;&#x5F88;&#x597D;&#x7406;&#x89E3;&#xFF0C;&#x5982;&#x679C;cacheconfig&#x4E2D;&#x8BBE;&#x7F6E;&#x4E86;&#x7F13;&#x5B58;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x5219;&#x5148;&#x56DE;&#x628A;&#x6570;&#x636E;&#x7F13;&#x5B58;&#x8FDB;&#x5185;&#x5B58;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x7F13;&#x5B58;&#x81F3;disk&#x6C99;&#x76D2;&#x4E2D;&#x3002;[self checkIfQueueIsIOQueue]&#x68C0;&#x67E5;&#x5F53;&#x524D;queue&#x662F;&#x4E0D;&#x662F;IOqueue&#x3002;&#x7136;&#x540E;&#x518D;&#x628A;&#x6570;&#x636E;&#x5199;&#x5165;&#x5BF9;&#x5E94;&#x7684;&#x8DEF;&#x5F84;&#x4E2D;&#x3002;</p>
</li>
<li><p>&#x53D6;Query</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">nullable</span> <span class="built_in">NSOperation</span> *)queryCacheOperationForKey:(<span class="keyword">nullable</span> <span class="built_in">NSString</span> *)key done:(<span class="keyword">nullable</span> SDCacheQueryCompletedBlock)doneBlock;</div></pre></td></tr></table></figure>
<p>&#x6700;&#x4E3B;&#x8981;&#x7684;&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x8FD9;&#x4E2A;&#xFF0C;&#x5176;&#x4E2D;&#x5148;&#x53BB;&#x5185;&#x5B58;&#x4E2D;&#x5BFB;&#x627E;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x547D;&#x4E2D;&#xFF0C;&#x5219;&#x5F02;&#x6B65;&#x53BB;disk&#x4E2D;&#x518D;&#x627E;&#xFF0C;&#x5982;&#x679C;&#x627E;&#x5230;&#x7684;&#x8BDD;&#xFF0C;&#x5219;&#x628A;&#x5F53;&#x524D;&#x56FE;&#x7247;&#x7F13;&#x5B58;&#x5728;&#x5185;&#x5B58;&#x91CC;&#x65B9;&#x4FBF;&#x4E0B;&#x4E00;&#x6B21;&#x5BFB;&#x627E;&#x7684;&#x7684;&#x540C;&#x65F6;&#xFF0C;&#x8FD4;&#x56DE;&#x56FE;&#x7247;&#x3002;</p>
</li>
<li><p>&#x5220;&#x9664;Remove</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)removeImageForKey:(<span class="keyword">nullable</span> <span class="built_in">NSString</span> *)key fromDisk:(<span class="built_in">BOOL</span>)fromDisk withCompletion:(<span class="keyword">nullable</span> SDWebImageNoParamsBlock)completion</div></pre></td></tr></table></figure>
<p>&#x5220;&#x9664;&#x903B;&#x8F91;&#x5C31;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#x4E86;&#xFF0C;&#x5982;&#x679C;&#x662F;cacheconfig&#x662F;shouldCacheImagesInMemory&#x7684;&#x8BDD;&#xFF0C;&#x5148;&#x5220;&#x9664;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#xFF0C;&#x518D;&#x5F02;&#x6B65;&#x5220;&#x9664;disk&#x4E2D;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x7136;&#x540E;&#x8DF3;&#x56DE;&#x4E3B;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x56DE;&#x8C03;&#x3002;</p>
</li>
</ul>
<h5 id="SDWebImageDownloader"><a href="#SDWebImageDownloader" class="headerlink" title="SDWebImageDownloader"></a>SDWebImageDownloader</h5><p>&#x5728;SDWebImage&#x4E2D;&#x53E6;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x90E8;&#x5206;&#x5C31;&#x662F;&#x4E0B;&#x8F7D;&#x5668;SDWebImageDownloader&#x4E86;&#xFF0C;&#x603B;&#x4F53;&#x5176;&#x4F7F;&#x7528;&#x4E86;NSURLSession&#x548C;NSOperation&#x8FDB;&#x884C;&#x8BBE;&#x8BA1;&#x548C;&#x5B9E;&#x73B0;&#x3002;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x6574;&#x4E2A;&#x4E0B;&#x8F7D;&#x5668;&#x6700;&#x4E3B;&#x8981;&#x7684;&#x4E86;&#x3002;</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">nullable</span> SDWebImageDownloadToken *)downloadImageWithURL:(<span class="keyword">nullable</span> <span class="built_in">NSURL</span> *)url options:(SDWebImageDownloaderOptions)options progress:(<span class="keyword">nullable</span> SDWebImageDownloaderProgressBlock)progressBlock completed:(<span class="keyword">nullable</span> SDWebImageDownloaderCompletedBlock)completedBlock;</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x9996;&#x5148;&#x4F1A;&#x8F6C;&#x5165;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x65B9;&#x6CD5;addProgressCallback&#xFF0C;&#x5E76;&#x4E14;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x5176;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x3002;&#x5728;addProgressCallback&#x4E2D;&#x4F1A;&#x6839;&#x636E;URL&#x53BB;URLOperations&#x91CC;&#x9762;&#x5BFB;&#x627E;&#x662F;&#x5426;&#x6709;&#x5BF9;&#x5E94;&#x7684;Operation,&#x6CA1;&#x6709;&#x7684;&#x8BDD;&#xFF0C;&#x5219;&#x628A;createCallback&#x8D4B;&#x503C;&#x7ED9;Operation&#x3002;</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">operation = createCallback();</div></pre></td></tr></table></figure>
<p>&#x5E76;&#x4E14;&#x52A0;&#x5165;&#x5230;&#x6570;&#x7EC4;URLOperations&#x4E2D;&#x4FDD;&#x5B58;&#x3002;&#x5728;URLOperations&#x7684;&#x5B8C;&#x6210;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x91CC;&#x5199;&#xFF0C;&#x5728;Operation&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x540E;&#xFF0C;&#x4ECE;URLOperations&#x4E2D;&#x5220;&#x9664;&#x3002;</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">id</span> downloadOperationCancelToken = [operation addHandlersForProgress:progressBlock completed:completedBlock];</div><div class="line">token = [SDWebImageDownloadToken new];</div><div class="line">token.url = url;</div><div class="line">token.downloadOperationCancelToken = downloadOperationCancelToken;</div></pre></td></tr></table></figure>
<p>&#x901A;&#x8FC7;addHandlersForProgress&#x65B9;&#x6CD5;&#xFF0C;&#x628A;&#x8FC7;&#x7A0B;&#x56DE;&#x8C03;progressBlock&#x548C;&#x5B8C;&#x6210;&#x56DE;&#x8C03;completedBlock&#x5C01;&#x88C5;&#x5728;&#x4E00;&#x4E2A;downloadOperationCancelToken&#x91CC;&#x9762;&#xFF0C;&#x5E76;&#x4E14;&#x5728;callbackBlocks&#x4E2D;&#x4FDD;&#x5B58;&#x3002;&#x7136;&#x540E;&#x518D;&#x751F;&#x6210;&#x4E00;&#x4E2A;SDWebImageDownloadToken&#xFF0C;&#x5206;&#x522B;&#x5305;&#x542B;URL&#x548C;Token&#x4FE1;&#x606F;&#x3002;&#x6700;&#x7EC8;&#x8FD4;&#x56DE;Token</p>
<p>&#x90A3;&#x4E48;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x770B;&#x770B;&#x524D;&#x9762;createCallback()&#x4E2D;&#x5230;&#x5E95;&#x505A;&#x4E86;&#x4EC0;&#x4E48;&#xFF1F;</p>
<p>&#x5728;createCallback()&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x6839;&#x636E;options&#x8BBE;&#x7F6E;&#x4E86;request&#x7684;&#x7F13;&#x5B58;&#x7B56;&#x7565;</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSURLRequestCachePolicy</span> cachePolicy = <span class="built_in">NSURLRequestReloadIgnoringLocalCacheData</span>;</div><div class="line">        <span class="keyword">if</span> (options &amp; SDWebImageDownloaderUseNSURLCache) {</div><div class="line">            <span class="keyword">if</span> (options &amp; SDWebImageDownloaderIgnoreCachedResponse) {</div><div class="line">                cachePolicy = <span class="built_in">NSURLRequestReturnCacheDataDontLoad</span>;</div><div class="line">            } <span class="keyword">else</span> {</div><div class="line">                cachePolicy = <span class="built_in">NSURLRequestUseProtocolCachePolicy</span>;</div><div class="line">            }</div><div class="line">        }</div></pre></td></tr></table></figure>
<p>&#x751F;&#x6210;&#x4E86;request&#xFF0C;&#x8BBE;&#x7F6E;requestheader&#xFF0C;cookies</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSMutableURLRequest</span> *request = [[<span class="built_in">NSMutableURLRequest</span> alloc] initWithURL:url cachePolicy:cachePolicy timeoutInterval:timeoutInterval];</div><div class="line">        request.HTTPShouldHandleCookies = (options &amp; SDWebImageDownloaderHandleCookies);</div><div class="line">        request.HTTPShouldUsePipelining = <span class="literal">YES</span>;</div><div class="line">        <span class="keyword">if</span> (sself.headersFilter) {</div><div class="line">            request.allHTTPHeaderFields = sself.headersFilter(url, [sself.HTTPHeaders <span class="keyword">copy</span>]);</div><div class="line">        }</div><div class="line">        <span class="keyword">else</span> {</div><div class="line">            request.allHTTPHeaderFields = sself.HTTPHeaders;</div><div class="line">        }</div></pre></td></tr></table></figure>
<p>&#x6839;&#x636E;request&#x548C;session&#x751F;&#x6210;SDWebImageDownloaderOperation&#x3002;&#x5BF9;Operation&#x7684;&#x4E00;&#x4E9B;&#x5C5E;&#x6027;&#x8FDB;&#x884C;&#x8BBE;&#x7F6E;&#xFF0C;&#x4F8B;&#x5982;credentials&#xFF08;&#x8BA4;&#x8BC1;&#xFF09;&#xFF0C;queuePriority&#xFF08;&#x961F;&#x5217;&#x4E2D;&#x4F18;&#x5148;&#x7EA7;&#xFF09;&#x7B49;&#x7B49;&#x3002;</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SDWebImageDownloaderOperation *operation = [[sself.operationClass alloc] initWithRequest:request inSession:sself.session options:options];</div></pre></td></tr></table></figure>
<p>&#x6700;&#x540E;&#x52A0;&#x5165;&#x5230;downloadQueue&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x5E76;&#x4E14;&#x6DFB;&#x52A0;&#x4E0A;&#x4E00;&#x4E2A;&#x52A0;&#x5165;&#x7684;lastAddedOperation&#x5BF9;&#x5F53;&#x524D;Operation&#x7684;&#x4F9D;&#x8D56;&#x3002;&#x4FDD;&#x8BC1;&#x5148;&#x8FDB;&#x540E;&#x51FA;&#x7684;&#x987A;&#x5E8F;&#x3002;&#xFF08;&#x53EF;&#x4EE5;&#x60F3;&#x8C61;&#x4E00;&#x4E0B;&#xFF0C;&#x4F60;&#x5FEB;&#x901F;&#x5237;&#x65B0;Tableview&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x540C;&#x65F6;&#x6709;&#x5F88;&#x591A;&#x56FE;&#x7247;&#x4E0B;&#x8F7D;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x662F;FIFO&#x7684;&#x8BDD;&#xFF0C;&#x4F60;&#x5DF2;&#x7ECF;&#x5728;&#x5E95;&#x90E8;&#x4E86;&#xFF0C;&#x56FE;&#x7247;&#x8FD8;&#x662F;&#x4ECE;&#x4E0A;&#x5F80;&#x4E0B;&#xFF0C;&#x6309;&#x7167;&#x8BF7;&#x6C42;&#x7684;&#x987A;&#x5E8F;&#x8FD4;&#x56DE;&#x662F;&#x4E0D;&#x662F;&#x4E0D;&#x5408;&#x7406;&#xFF0C;&#x5408;&#x7406;&#x7684;&#x5E94;&#x8BE5;&#x662F;&#x4F60;&#x5F53;&#x524D;&#x773C;&#x775B;&#x770B;&#x5230;&#x7684;&#x90A3;&#x90E8;&#x5206;&#x56FE;&#x7247;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6700;&#x540E;&#x53D1;&#x51FA;&#x7684;&#x90A3;&#x4E9B;&#x8BF7;&#x6C42;&#x5148;&#x8FD4;&#x56DE;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x5F88;&#x597D;&#x7406;&#x89E3;&#x4E86;&#x3002;&#xFF09;</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[sself.downloadQueue addOperation:operation];</div><div class="line">        <span class="keyword">if</span> (sself.executionOrder == SDWebImageDownloaderLIFOExecutionOrder) {</div><div class="line">            [sself.lastAddedOperation addDependency:operation];</div><div class="line">            sself.lastAddedOperation = operation;</div><div class="line">        }</div></pre></td></tr></table></figure>
<p>&#x6700;&#x540E;&#x8FD4;&#x56DE;operation&#x3002;</p>
<p>&#x6B64;&#x5916;&#xFF0C;&#x8FD8;&#x6709;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x5C31;&#x662F;&#x53D6;&#x6D88;&#x4EFB;&#x52A1;&#x7684;&#x529F;&#x80FD;&#x3002;</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)cancel:(<span class="keyword">nullable</span> SDWebImageDownloadToken *)token</div></pre></td></tr></table></figure>
<p>&#x9996;&#x5148;&#x8FDB;&#x5165;&#x5230;dispatch_barrier_async&#x4E2D;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#xFF0C;&#x6805;&#x680F;&#x51FD;&#x6570;&#x7684;&#x4F5C;&#x7528;&#x662F;&#xFF0C;&#x5728;&#x5176;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x4FDD;&#x8BC1;&#x5728;&#x5176;&#x4E4B;&#x524D;&#x7684;&#x6240;&#x6709;&#x4EFB;&#x52A1;&#x90FD;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x540E;&#x624D;&#x4F1A;&#x6267;&#x884C;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x5176;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x540E;&#xFF0C;&#x540E;&#x9762;&#x7684;&#x5176;&#x4ED6;&#x4EFB;&#x52A1;&#x624D;&#x80FD;&#x6B63;&#x5E38;&#x6267;&#x884C;&#x3002;&#x5018;&#x82E5;&#x4E00;&#x4E2A;&#x961F;&#x5217;&#x4E2D;&#x6240;&#x6709;&#x7684;&#x51FD;&#x6570;&#x90FD;&#x662F;&#x6805;&#x680F;&#x51FD;&#x6570;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x961F;&#x5217;&#x867D;&#x7136;&#x672C;&#x8EAB;&#x662F;&#x5E76;&#x884C;&#x961F;&#x5217;&#xFF0C;&#x4F46;&#x5B9E;&#x9645;&#x6548;&#x679C;&#x662F;&#x4E32;&#x884C;&#x961F;&#x5217;&#x7684;&#x6548;&#x679C;&#x3002;&#x5728;dispatch_barrier_async&#x4E2D;&#x5206;&#x522B;&#x5220;&#x9664;callbackBlocks&#x548C;URLOperations&#x4E2D;&#x548C;token&#x6240;&#x5BF9;&#x5E94;&#x7684;&#x5BF9;&#x8C61;&#x3002;</p>
<h5 id="SDWebImageDownloaderOperation"><a href="#SDWebImageDownloaderOperation" class="headerlink" title="SDWebImageDownloaderOperation"></a>SDWebImageDownloaderOperation</h5><p>&#x9996;&#x5148;&#xFF0C;SDWebImageDownloaderOperation&#x662F;&#x7EE7;&#x627F;&#x4E8E;NSOperation&#x7684;&#xFF0C;&#x628A;&#x5176;&#x52A0;&#x5165;&#x4E00;&#x4E2A;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x5C31;&#x4F1A;&#x81EA;&#x52A8;&#x6267;&#x884C;&#xFF0C;&#x8FD9;&#x662F;NSOperation&#x7684;&#x7279;&#x70B9;&#x3002;&#x8FD9;&#x91CC;&#x7684;SDWebImageDownloaderOperation&#x662F;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;NSOperation&#xFF0C;&#x81EA;&#x5B9A;&#x4E49;NSOperation&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;start&#x65B9;&#x6CD5;&#xFF0C;&#x81EA;&#x5DF1;&#x7EF4;&#x62A4;isFinished&#x548C;isExecuting&#x7B49;&#x5C5E;&#x6027;&#x3002;</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)start</div></pre></td></tr></table></figure>
<p>&#x5728;start&#x65B9;&#x6CD5;&#x91CC;&#xFF0C;&#x5927;&#x81F4;&#x505A;&#x4E86;&#x751F;&#x6210;unownedSession&#xFF0C;dataTask&#xFF0C;&#x6267;&#x884C;dataTask&#x7B49;&#x5DE5;&#x4F5C;&#x3002;</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[<span class="keyword">self</span>.dataTask resume]</div></pre></td></tr></table></figure>
<p>&#x5728;&#x5F00;&#x59CB;&#x6267;&#x884C;&#x4E4B;&#x540E;&#xFF0C;&#x8FDB;&#x884C;&#x8C03;&#x7528;&#x4FDD;&#x5B58;&#x5728;callbackBlocks&#x4E2D;&#x7684;&#x6240;&#x6709;progressBlock&#xFF0C;&#x5E76;&#x4E14;&#x8BBE;&#x7F6E;self.executing = YES&#x3002;&#x6700;&#x540E;&#x53D1;&#x9001;&#x901A;&#x77E5;SDWebImageDownloadStartNotification&#xFF0C;&#x8868;&#x793A;&#x4EFB;&#x52A1;&#x5DF2;&#x7ECF;&#x5F00;&#x59CB;&#x3002;</p>
<p>&#x540C;&#x65F6;&#x4E5F;&#x8981;&#x5B9E;&#x73B0;done&#x51FD;&#x6570;&#xFF0C;&#x8868;&#x793A;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x3002;</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)done {</div><div class="line">    <span class="keyword">self</span>.finished = <span class="literal">YES</span>;</div><div class="line">    <span class="keyword">self</span>.executing = <span class="literal">NO</span>;</div><div class="line">    [<span class="keyword">self</span> reset];</div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x4E00;&#x4E2A;&#x5C0F;tips&#xFF1A;</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@synthesize</span> finished = _finished;</div><div class="line">- (<span class="keyword">void</span>)setFinished:(<span class="built_in">BOOL</span>)finished {</div><div class="line">    [<span class="keyword">self</span> willChangeValueForKey:<span class="string">@&quot;isFinished&quot;</span>];</div><div class="line">    _finished = finished;</div><div class="line">    [<span class="keyword">self</span> didChangeValueForKey:<span class="string">@&quot;isFinished&quot;</span>];</div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x6837;&#x5199;&#x7684;&#x597D;&#x5904;&#x662F;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x8BBE;&#x7F6E;&#x5F53;&#x524D;&#x7684;finished&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x76F8;&#x5F53;&#x4E8E;&#x8BBE;&#x7F6E;&#x4E86;isFinished&#xFF0C;&#x6240;&#x6709;&#x5BF9;&#x5176;&#x7684;KVO&#x90FD;&#x4F1A;&#x751F;&#x6548;&#x3002;</p>
<h5 id="&#x4E00;&#x4E9B;&#x9605;&#x8BFB;&#x4EE3;&#x7801;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;tips"><a href="#&#x4E00;&#x4E9B;&#x9605;&#x8BFB;&#x4EE3;&#x7801;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;tips" class="headerlink" title="&#x4E00;&#x4E9B;&#x9605;&#x8BFB;&#x4EE3;&#x7801;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;tips"></a>&#x4E00;&#x4E9B;&#x9605;&#x8BFB;&#x4EE3;&#x7801;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;tips</h5><ul class="ui list">
<li>&#x4F7F;&#x7528;@synchronized&#x4FDD;&#x8BC1;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#xFF0C;&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#x5C31;&#x662F;&#x76F8;&#x5F53;&#x4E8E;&#x5BF9;runningOperations&#x52A0;&#x4E86;&#x9501;&#xFF0C;&#x4FDD;&#x8BC1;&#x7684;&#x5176;&#x5728;&#x4E0D;&#x540C;&#x7EBF;&#x7A0B;&#x8BBF;&#x95EE;&#x662F;&#x4E0D;&#x4F1A;&#x4EA7;&#x751F;&#x9519;&#x8BEF;&#x3002;</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@synchronized</span> (<span class="keyword">self</span>.runningOperations) {</div><div class="line">        [<span class="keyword">self</span>.runningOperations addObject:operation];</div><div class="line">    }</div></pre></td></tr></table></figure>

                        
                    </div>

                    
                    
                    

                    <div class="description post-description">
    <span class="post-description-item">
        <time datetime="2017-09-18T01:51:53.000Z" itemprop="datePublished">2017-09-18</time>

    </span>
    <span class="post-description-item">
        
    </span>
</div>

                </div>
                
                <div id="pagination" class="nav-web ui text container pagination">

    <div class="ui stackable two column divided grid container">
        <div class="row">
            <div class="column nav-left">
                

                <a href="/2017/09/18/同一台电脑配置多个SSHKey/" class="ui tiny button">

                    <i class="angle left icon"></i>
                    
                    同一台电脑配置多个SSHKey
                    

                </a>

                
            </div>
            <div class="column nav-right">
                

                <a href="/2017/09/14/WebRTC-编译以及运行IOS的Demo/" class="ui tiny button">
                    
                    WebRTC-编译以及运行IOS的Demo
                    
                    <i class="angle right icon"></i></a>
                
            </div>
        </div>
    </div>

</div>
                
            </div>

            
            <div class="three wide computer three wide tablet column">

                <div class="ui sticky article-toc" id="article-toc">
                    <!-- toc -->
                    <ol class="ui ordered list"><li><a href="#重读SDWebImage"><span>重读SDWebImage</span></a><ol><li><a href="#SDWebImageManager"><span>SDWebImageManager</span></a></li><li><a href="#SDImageCache"><span>SDImageCache</span></a></li><li><a href="#SDWebImageDownloader"><span>SDWebImageDownloader</span></a></li><li><a href="#SDWebImageDownloaderOperation"><span>SDWebImageDownloaderOperation</span></a></li><li><a href="#一些阅读代码过程中的tips"><span>一些阅读代码过程中的tips</span></a></li></ol></li></ol>
                </div>

            </div>
            

        </div>
    </div>
</div>


                    <!--</div>-->
                <!--</div>-->
            <!--</div>-->
        </div>
        <div class="ui vertical footer segment">
    <div class="ui center aligned container">
        <div class="ui inverted section divider"></div>
        &copy; 2017 <a href="/">Wooop</a>,
        Powered by <a href="https://github.com/henryhuang/hexo-theme-aloha" target="_blank">Aloha</a> and <a
                href="http://hexo.io/" target="_blank">Hexo</a>.
    </div>
</div>

    </div>




<!-- scripts list from theme config.yml -->

<script src="//cdn.bootcss.com/jquery/3.1.0/jquery.min.js"></script>

<script src="//cdn.bootcss.com/semantic-ui/2.2.4/semantic.min.js"></script>

<script src="//cdn.bootcss.com/algoliasearch/3.18.1/algoliasearch.min.js"></script>

<script src="//cdn.bootcss.com/algoliasearch-helper-js/2.13.0/algoliasearch.helper.min.js"></script>

<script src="/js/semantic-ui-algolia.js"></script>

<script src="/js/aloha-events.js"></script>



</body>
</html>
